machine:
  environment:
    GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx3g -XX:+HeapDumpOnOutOfMemoryError"'

dependencies:
  pre:
    - cp -r "circle-ci/licenses/" "/usr/local/android-sdk-linux/"
  cache_directories:
    - ~/.android

test:
  override:
    # Runner 1
    # Run unit tests
    # Copy the test results to the test results dir

    # Runner 2
    # Build pure debug apk.
    # Copy apk file to CircleCI artifacts dir

    - case $CIRCLE_NODE_INDEX in 1) ./gradlew jacocoTestDebugUnitTestReport ;; 0) ./gradlew assemblePureDebug ;; esac:
        parallel: true

    - case $CIRCLE_NODE_INDEX in 1) cp -r --parents ./**/build/{test-results/*,reports/jacoco/*} $CIRCLE_TEST_REPORTS -v ;; 0)cp -r app/build/outputs $CIRCLE_ARTIFACTS -v ;; esac:
        parallel: true

  post:
    - bash <(curl -s https://codecov.io/bash)